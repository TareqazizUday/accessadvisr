{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Donate - AccessAdvisr</title>
	<link rel="stylesheet" href="{% static 'css/accessadvisr-style.css' %}">
	<link rel="stylesheet" href="{% static 'css/components/donation_popup.css' %}">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>
	
<!-- include navbar -->
{% include 'components/navbar.html' %}

<!----- inner header section ------>
<section class="partners-header-section">
    <div class="container text-center py-5">
        <h1 class="text-white fw-bold mb-2">Donate</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-white text-decoration-none">HOME</a></li>
                <li class="breadcrumb-item active text-orange" aria-current="page">Donate</li>
            </ol>
        </nav>
    </div>
</section>

<!----- video-slider-section ------>
{% include 'components/video_slider.html' %}


<!---- sub heading ------>
<div class="container text-center mt-5 mb-4">
    <h2 class="fw-bold sponsor-heading">Why You Should Donate</h2>
    <div class="orange-divider mx-auto"></div>
</div>


<!----- sub header description section ------>
<section class="donate-description-section">
    <div class="container mt-4 mb-5">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10 text-start">
                <p>
                    AccessAdvisr is dedicated to making the world more accessible for disabled people everywhere. Our platform allows users to share honest reviews about the accessibility of places, 
                    helping others make informed decisions before visiting. With over 2,600 reviews worldwide, we provide a free, reliable resource that empowers the disabled community.
                </p>

                <p>
                    Running and improving this website comes with costs. Your donation helps us enhance features, 
                    introduce new tools, and ensure the site meets the latest accessibility standards. It allows us to expand our reach, improve user experience, and 
                    continue offering free, accurate information to those who need it most.
                </p>

                <p>
                    By donating, you become part of a movement that values inclusion and accessibility. Your support not only funds website upgrades and maintenance 
                    but also strengthens a community dedicated to making travel and everyday experiences easier and more enjoyable for everyone. Every contribution, 
                    big or small, helps us grow and make a real difference.
                </p>
            </div>
        </div>
    </div>
</section>

<!---- sub heading ------>
<div class="container text-center mt-5 mb-4">
    <h2 class="fw-bold sponsor-heading">All Donation Types</h2>
    <div class="orange-divider mx-auto"></div>
</div>

<!----- donate card section ------>
{% include 'components/donate_card_section.html' %}

<!---- sub heading ------>
<div class="container text-center mt-5 mb-4">
    <h2 class="fw-bold sponsor-heading">Frequently Asked Questions</h2>
    <div class="orange-divider mx-auto"></div>
</div>

<!------- donate accordion section ------>
{% include 'components/donate_accordion.html' %}

<section class="spacer">
</section>

<!---------- footer section ---------->
{% include 'components/footer.html' %}

<!------- donation popup form ------>
{% include 'components/donation_popup_form.html' %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script>
    // Donation Popup Functionality
    document.addEventListener('DOMContentLoaded', function() {
        const popupOverlay = document.getElementById('donationPopupOverlay');
        const closeBtn = document.getElementById('closeDonationPopup');
        const donationForm = document.getElementById('donationForm');
        const customAmountGroup = document.getElementById('custom_amount_group');
        const customAmountInput = document.getElementById('custom_amount');
        const amountRadios = document.querySelectorAll('input[name="donation_amount"]');
        
        // Open popup when donate button is clicked
        document.querySelectorAll('.donate-btn, .btn-orange').forEach(btn => {
            if (btn.textContent.includes('Donate') || btn.classList.contains('donate-btn')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Get campaign ID from button or card
                    const campaignId = this.getAttribute('data-campaign-id') || 
                                     this.closest('.card')?.getAttribute('data-campaign-id') || '';
                    document.getElementById('donation_campaign_id').value = campaignId;
                    popupOverlay.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                });
            }
        });
        
        // Close popup
        function closePopup() {
            popupOverlay.style.display = 'none';
            document.body.style.overflow = '';
            donationForm.reset();
            customAmountGroup.style.display = 'none';
        }
        
        closeBtn.addEventListener('click', closePopup);
        
        // Close on overlay click
        popupOverlay.addEventListener('click', function(e) {
            if (e.target === popupOverlay) {
                closePopup();
            }
        });
        
        // Show/hide custom amount field
        amountRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'other') {
                    customAmountGroup.style.display = 'block';
                    customAmountInput.required = true;
                } else {
                    customAmountGroup.style.display = 'none';
                    customAmountInput.required = false;
                    customAmountInput.value = '';
                }
            });
        });
        
        // Form submission
        donationForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';
            
            // Remove previous error messages
            const existingErrors = this.querySelectorAll('.error-message');
            existingErrors.forEach(err => err.remove());
            
            const formData = {
                campaign_id: document.getElementById('donation_campaign_id').value || null,
                name: document.getElementById('donor_name').value.trim(),
                email: document.getElementById('donor_email').value.trim(),
                phone: document.getElementById('donor_phone').value.trim(),
                street_address: document.getElementById('street_address').value.trim(),
                apartment_suite: document.getElementById('apartment_suite').value.trim(),
                city: document.getElementById('city').value.trim(),
                state_province: document.getElementById('state_province').value.trim(),
                zip_postal_code: document.getElementById('zip_postal_code').value.trim(),
                country: document.getElementById('country').value.trim(),
                donation_amount: document.querySelector('input[name="donation_amount"]:checked').value,
                custom_amount: customAmountInput.value ? parseFloat(customAmountInput.value) : null,
                payment_method: document.querySelector('input[name="payment_method"]:checked').value,
                consent_given: document.getElementById('consent').checked
            };
            
            try {
                const response = await fetch('/api/donations/submit/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.className = 'alert alert-success mt-3';
                    successMsg.textContent = 'Donation submitted successfully! Redirecting to payment...';
                    donationForm.insertBefore(successMsg, donationForm.firstChild);
                    
                    // Here you would redirect to Stripe/PayPal payment page
                    // For now, just close popup after 2 seconds
                    setTimeout(() => {
                        closePopup();
                        // In production, redirect to payment gateway:
                        // if (data.payment_method === 'stripe') {
                        //     window.location.href = `/payment/stripe/${data.donation_id}/`;
                        // } else if (data.payment_method === 'paypal') {
                        //     window.location.href = `/payment/paypal/${data.donation_id}/`;
                        // }
                    }, 2000);
                } else {
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'alert alert-danger mt-3 error-message';
                    errorMsg.textContent = data.error || 'Failed to submit donation. Please try again.';
                    donationForm.insertBefore(errorMsg, donationForm.firstChild);
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            } catch (error) {
                console.error('Error:', error);
                const errorMsg = document.createElement('div');
                errorMsg.className = 'alert alert-danger mt-3 error-message';
                errorMsg.textContent = 'Error submitting donation. Please try again.';
                donationForm.insertBefore(errorMsg, donationForm.firstChild);
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });
    });
</script>
</body>
</html>

